    {% extends 'xgds_image/imageDashboardBase.html' %}

    {%  block scripts %}
    {{  block.super }}

        <script type="text/javascript" src='{{ EXTERNAL_URL }}fabric.js/dist/fabric.min.js'></script>
    <script type="text/javascript" src='{{ EXTERNAL_URL }}openseadragon-fabricjsOverlay/openseadragon-fabricjs-overlay.js'></script>
    {#<script type="text/javascript" src='{{ EXTERNAL_URL }}openseadragon-annotations/dist/openseadragon-annotations.js'></script>#}
    {%  endblock scripts %}

    {%  block content %}
    <h1>Emigre Sandbox beta</h1>
    <div id="openseadragon1" style="width: 800px; height: 600px;"></div>
        <button type="button" id="toggleMapScrolling">Toggle Map Scrolling</button>
    {%  endblock content  %}

        {% block jsInit %}
        var prefixUrl = '/static/openseadragon/built-openseadragon/openseadragon/images/';
        var viewer = OpenSeadragon({
                    id:            "openseadragon1",
                    prefixUrl:     prefixUrl,
                    showNavigator: true,
                    gestureSettingsMouse:   {
                        clickToZoom: false
                    },
                    clickToZoom: "false",
                    tileSources:   [{
                        Image:  {
                            //Need to change [tile_format="jpg", image_quality=0.85,]
                            //Plus any other changes in deepzoom.py we make
                            xmlns: "http://schemas.microsoft.com/deepzoom/2009",
                            Url: "../../../../data/images/spacePics/ISS044-E-1998_files/",
                            TileSize: "128",
                            Overlap: "2",
                            Format: "png",
                            ServerFormat: "Default",
                            Size: {
                                Width: "4928",
                                Height: "3280",
                            }
                        }
                    }],
                });
            var overlay = viewer.fabricjsOverlay();
                // add fabric rectangle

            var rect = new fabric.Rect({
                left: 0,
                top: 0,
                fill: 'red',
                width: 1000,
                height: 1000
            });
{#            canvas = overlay.fabricCanvas();#}
            console.log("hello world");


            function addRectangle(x, y) {
                 var rect = new fabric.Rect({
                    left: x,
                    top: y,
                    fill: 'blue',
                    width: 1000,
                    height: 1000
                });
                overlay.fabricCanvas().add(rect);
                overlay.fabricCanvas().renderAll();
            }

            function addCircle(x, y) {
                var circle = new fabric.Circle({
                    left: x,
                    top: y,
                    radius: 225,
                    strokeWidth: 1,
                    stroke: 'black',
                    fill: 'white',
                    selectable: true,
                    originX: 'center', originY: 'center'
                });
                overlay.fabricCanvas().add(circle);
                overlay.fabricCanvas().renderAll();
            }

            viewer.addHandler('canvas-click', function(event) {
                var pointer = overlay.fabricCanvas().getPointer(event.e);

                addCircle(pointer.x, pointer.y);
                addRectangle(pointer.x, pointer.y);

            });

            //TODO: use to track cirlc center.
            viewer.addHandler('press', function(event) {
                //what does this even do? Doesn't work when mapScrolling is disabled soooooooo
                //is never triggered at all kek totally useless
                console.log("press event");
            });

            //TODO: use to calculate final circle radius size?
            viewer.addHandler('release', function(event) {
                console.log("release event");
            });

            //TODO: use this to draw circles live
            viewer.addHandler('canvas-drag', function(event) {
                console.log("you're dragging m8");
            });

            //so this is trigerred here...
            overlay.fabricCanvas().observe('mouse:down', function(o){
                console.log("mouse down event");
                isDown = true;
                var pointer = overlay.fabricCanvas().getPointer(o.e);
                addCircle(pointer.x, pointer.y);
                origX = pointer.x;
                origY = pointer.y;
                var circle = new fabric.Circle({
                    left: pointer.x,
                    top: pointer.y,
                    radius: 1,
                    strokeWidth: 1,
                    stroke: 'black',
                    fill: 'white',
                    selectable: true,
                    originX: 'center', originY: 'center'
                });
                overlay.fabricCanvas().add(circle);
                overlay.fabricCanvas().renderAll();
            });


            overlay.fabricCanvas().add(rect);


            //TODO:
            //$("#selec").click(function(){
            //  canvas.isDrawingMode = false;
            //    canvas.selection= true;
            //    canvas.off('mouse:down');
            //    canvas.off('mouse:move');
            //    canvas.off('mouse:up');
            //    canvas.forEachObject(function(o){ o.setCoords() })
            //})

            //add jquery button

            $("#toggleMapScrolling").click(function() {
                console.log("toggle dat map scrolling boi");
                viewer.setMouseNavEnabled(false);

                //so this works, but then the canvas drawing stops working too... hmm..
            })
        {% endblock jsInit %}

