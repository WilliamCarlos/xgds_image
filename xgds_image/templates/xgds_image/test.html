    {% extends 'xgds_image/imageDashboardBase.html' %}

    {%  block scripts %}
    {{  block.super }}

        <script type="text/javascript" src='{{ EXTERNAL_URL }}fabric.js/dist/fabric.min.js'></script>
    <script type="text/javascript" src='{{ EXTERNAL_URL }}openseadragon-fabricjsOverlay/openseadragon-fabricjs-overlay.js'></script>
    {#<script type="text/javascript" src='{{ EXTERNAL_URL }}openseadragon-annotations/dist/openseadragon-annotations.js'></script>#}
    {%  endblock scripts %}

    {%  block content %}
    <h1>Emigre Sandbox beta</h1>
    <div id="openseadragon1" style="width: 800px; height: 600px;"></div>
        <button type="button" id="toggleMapScrolling">Toggle Map Scrolling</button>
    {%  endblock content  %}

        {% block jsInit %}
          var prefixUrl = '/static/openseadragon/built-openseadragon/openseadragon/images/';
        var viewer = OpenSeadragon({
                    id:            "openseadragon1",
                    prefixUrl:     prefixUrl,
                    showNavigator: true,
                    gestureSettingsMouse:   {
                        clickToZoom: false
                    },
                    clickToZoom: "false",
                    tileSources:   [{
                        Image:  {
                            //Need to change [tile_format="jpg", image_quality=0.85,]
                            //Plus any other changes in deepzoom.py we make
                            xmlns: "http://schemas.microsoft.com/deepzoom/2009",
                            Url: "../../../../data/images/spacePics/ISS044-E-1998_files/",
                            TileSize: "128",
                            Overlap: "2",
                            Format: "png",
                            ServerFormat: "Default",
                            Size: {
                                Width: "4928",
                                Height: "3280",
                            }
                        }
                    }],
                });
            //fabricjs-openseadragon annotation
            var overlay = viewer.fabricjsOverlay();
                // add fabric rectangle

            console.log("hello world");

            //create a new rectangle and add to canvas
            function addRectToCanvas(x, y) {
                 var rect = new fabric.Rect({
                    left: x,
                    top: y,
                    fill: 'blue',
                    width: 1000,
                    height: 1000
                });
                overlay.fabricCanvas().add(rect);
                overlay.fabricCanvas().renderAll();
            }

            //create a new circle and add it to canvas
            function addCircleToCanvas(x, y) {
                var circle = new fabric.Circle({
                    left: x,
                    top: y,
                    radius: 225,
                    strokeWidth: 1,
                    stroke: 'black',
                    fill: 'white',
                    selectable: true,
                    originX: 'center', originY: 'center'
                });
                overlay.fabricCanvas().add(circle);
                overlay.fabricCanvas().renderAll();
            }

 var circle, isDown, origX, origY;

            //TODO: Create overloaded initializeCircle function
            function initializeCircle(x, y) {
                console.log("circle is set tho");
                circle = new fabric.Circle({
                    left: x,
                    top: y,
                    radius: 1,
                    strokeWidth: 1,
                    stroke: 'black',
                    fill: 'white',
                    selectable: true,
                    originX: 'center', originY: 'center'
                });
                overlay.fabricCanvas().add(circle);
            }


            //TODO: should I update the circle member variable automatically or pass in the object to modify?
            function updateCircleRadius(x, y, origX) {
                circle.set({radius: Math.abs(origX - x)});
                //TODO: check this radius measure, seems funky.. it's only x distance?
            }

 overlay.fabricCanvas().observe('mouse:down', function(o){
     console.log("EVENT TRIGERRED: fabricjs-mouse:down");
     isDown = true;
     var pointer = overlay.fabricCanvas().getPointer(o.e);
     origX = pointer.x;
     origY = pointer.y;

     initializeCircle(pointer.x, pointer.y)
 });

 overlay.fabricCanvas().observe('mouse:move', function(o){
     console.log("EVENT TRIGERRED: fabricjs-mouse:move");
     if (!isDown) return;
     var pointer = overlay.fabricCanvas().getPointer(o.e);
     updateCircleRadius(pointer.x, pointer.y, origX); //do I need to pass this or can I access it as a member? in general, need to clarify b/w member obj.
     overlay.fabricCanvas().renderAll();
 });

 overlay.fabricCanvas().on('mouse:up', function(o){
     console.log("EVENT TRIGERRED: fabricj-mouse:up");
     isDown = false;
 });

 viewer.addHandler('canvas-click', function(event) {
                var pointer = overlay.fabricCanvas().getPointer(event.e);
                console.log("EVENT TRIGERRED: OSD-canvas-click")
            });


            $("#toggleMapScrolling").click(function() {
                console.log("toggle dat map scrolling boi");
                viewer.setMouseNavEnabled(false);

                //so this works, but then the canvas drawing stops working too... hmm..
            })
        {% endblock jsInit %}

